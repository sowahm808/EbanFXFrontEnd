import{a as W}from"./chunk-ES6ILSZM.js";import{a as J}from"./chunk-H3UCXOXM.js";import{B as l,D as p,Da as A,E as y,Ea as j,F as h,G as I,Ha as L,Ia as Y,J as n,Ja as z,K as e,L as q,M as w,N as c,O as g,P as o,R as u,U as k,b as f,da as D,ga as b,ha as E,ia as F,ja as T,l as _,la as G,ma as N,na as V,o as S,oa as M,ra as P,sa as U,t as m,ta as O,ua as Q,v as C,va as R,wa as B,x,xa as H,y as v,ya as K,za as $}from"./chunk-TNJDMAVS.js";import"./chunk-ULBIGD3G.js";import"./chunk-FEBVYFP7.js";import"./chunk-JM4337FT.js";import"./chunk-BVYU3FJT.js";import"./chunk-JDETYR3C.js";import"./chunk-7SKQ7KRS.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-REYR55MP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{f as d}from"./chunk-TJJGX4BS.js";function X(s,Z){if(s&1){let t=w();n(0,"div")(1,"p"),o(2),e(),n(3,"p"),o(4),e(),n(5,"p"),o(6),e(),n(7,"p"),o(8),e()(),n(9,"ion-button",7),c("click",function(){x(t);let r=g();return v(r.createOrder())}),o(10,"Create Order"),e()}if(s&2){let t,i,r,a=g();l(2),u("Rate: ",(t=a.quote())==null?null:t.customerRate,""),l(2),u("USD: ",(i=a.quote())==null?null:i.amountUsd,""),l(2),u("Fee (GHS): ",(r=a.quote())==null?null:r.feeGhs,""),l(2),u("Expires in: ",a.remainingSeconds(),"s"),l(),h("disabled",a.remainingSeconds()===0)}}var ue=(()=>{class s{constructor(){this.fb=m(V),this.api=m(J),this.userService=m(W),this.loadingCtrl=m(L),this.toastCtrl=m(Y),this.router=m(D),this.destroy$=new f,this.quoteForm=this.fb.nonNullable.group({amountGhs:[0,[b.required,b.min(1)]]}),this.quote=p(null),this.remainingSeconds=p(0)}ngOnInit(){this.userService.refreshMe().subscribe(),_(1e3).pipe(S(this.destroy$)).subscribe(()=>this.tickCountdown())}createQuote(){return d(this,null,function*(){if(this.quoteForm.invalid)return;let t=yield this.loadingCtrl.create({message:"Fetching quote..."});yield t.present(),this.api.createQuote(this.quoteForm.getRawValue()).subscribe({next:i=>d(this,null,function*(){this.quote.set(i),this.tickCountdown(),yield t.dismiss()}),error:()=>d(this,null,function*(){yield t.dismiss(),yield(yield this.toastCtrl.create({message:"Could not create quote.",duration:1800,color:"danger"})).present()})})})}tickCountdown(){let t=this.quote();if(!t)return;let i=Math.max(0,Math.floor((new Date(t.expiresAt).getTime()-Date.now())/1e3));this.remainingSeconds.set(i)}goToKyc(){this.router.navigateByUrl("/kyc")}createOrder(){this.router.navigateByUrl("/tabs/orders",{state:{quote:this.quote()}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275cmp=C({type:s,selectors:[["ng-component"]],standalone:!0,features:[k],decls:22,vars:3,consts:[[1,"ion-padding"],[1,"status-pill"],["expand","block","fill","outline",3,"click"],[3,"ngSubmit","formGroup"],["position","stacked"],["type","number","formControlName","amountGhs"],["expand","block","type","submit",1,"ion-margin-top"],["expand","block",3,"click","disabled"]],template:function(i,r){if(i&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o(3,"Dashboard"),e()()(),n(4,"ion-content",0)(5,"p",1),o(6),e(),n(7,"ion-button",2),c("click",function(){return r.goToKyc()}),o(8,"Verify KYC"),e(),n(9,"ion-card")(10,"ion-card-header")(11,"ion-card-title"),o(12,"Create Quote"),e()(),n(13,"ion-card-content")(14,"form",3),c("ngSubmit",function(){return r.createQuote()}),n(15,"ion-item")(16,"ion-label",4),o(17,"Amount (GHS)"),e(),q(18,"ion-input",5),e(),n(19,"ion-button",6),o(20,"Create Quote"),e()(),y(21,X,11,5),e()()()),i&2){let a;l(6),u("KYC: ",((a=r.userService.profileSignal())==null?null:a.kycStatus)||"not_submitted",""),l(8),h("formGroup",r.quoteForm),l(7),I(21,r.quote()?21:-1)}},dependencies:[H,j,A,B,U,Q,R,O,P,K,$,z,M,T,E,F,G,N],encapsulation:2})}}return s})();export{ue as DashboardPage};
